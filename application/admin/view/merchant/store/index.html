<div class="panel panel-default panel-intro">
    {:build_heading()}

    <div class="panel-body">
        <div id="myTabContent" class="tab-content">
            <div class="tab-pane fade active in" id="one">
                <div class="widget-body no-padding">
                    <div id="toolbar" class="toolbar">
                        <a href="javascript:;" class="btn btn-primary btn-refresh" title="{:__('Refresh')}" ><i class="fa fa-refresh"></i> </a>
                        <!-- <a href="javascript:;" class="btn btn-success btn-add {:$auth->check('merchant/store/add')?'':'hide'}" title="{:__('Add')}" ><i class="fa fa-plus"></i> {:__('Add')}</a> -->
                        <!-- <a href="javascript:;" class="btn btn-success btn-edit btn-disabled disabled {:$auth->check('merchant/store/edit')?'':'hide'}" title="{:__('Edit')}" ><i class="fa fa-pencil"></i> {:__('Edit')}</a> -->
                        <!-- <a href="javascript:;" class="btn btn-danger btn-del btn-disabled disabled {:$auth->check('merchant/store/del')?'':'hide'}" title="{:__('Delete')}" ><i class="fa fa-trash"></i> {:__('Delete')}</a> -->
                        <!-- <a href="javascript:;" class="btn btn-danger btn-import {:$auth->check('merchant/store/import')?'':'hide'}" title="{:__('Import')}" id="btn-import-file" data-url="ajax/upload" data-mimetype="csv,xls,xlsx" data-multiple="false"><i class="fa fa-upload"></i> {:__('Import')}</a> -->

                        <!-- <div class="dropdown btn-group {:$auth->check('merchant/store/multi')?'':'hide'}">
                            <a class="btn btn-primary btn-more dropdown-toggle btn-disabled disabled" data-toggle="dropdown"><i class="fa fa-cog"></i> {:__('More')}</a>
                            <ul class="dropdown-menu text-left" role="menu">
                                <li><a class="btn btn-link btn-multi btn-disabled disabled" href="javascript:;" data-params="status=normal"><i class="fa fa-eye"></i> {:__('Set to normal')}</a></li>
                                <li><a class="btn btn-link btn-multi btn-disabled disabled" href="javascript:;" data-params="status=hidden"><i class="fa fa-eye-slash"></i> {:__('Set to hidden')}</a></li>
                            </ul>
                        </div> -->
                    </div>
                    <table id="table" class="table table-striped table-bordered table-hover table-nowrap"
                           data-operate-edit="{:$auth->check('merchant/store/edit')}" 
                           data-operate-del="{:$auth->check('merchant/store/del')}" 
                           width="100%">
                    </table>
                </div>
            </div>

        </div>
    </div>
</div>


<script>


var func = function () {
        $.ajax({
            type:'POST',
            url:'merchant/store/hint',
            dataType:'json',
            success:function(data){
                console.log(data);
                if (window.Notification) {
                    for(var i = 0; i < data.length; i++) {
                        var popNotice = function() {
                            if (Notification.permission == "granted") {
                                var notification = new Notification("Hi，帅哥：", {
                                    body: '店铺名：' + data[i].store_name + '，正在等待您的审核，请加快审核速度呦！',
                                    icon: data[i].store_img,
                                    silent: true
                                });
                            }    
                        };
                        
                        console.log(data[i].auditstatus);
                        if (data[i].auditstatus == 'wait_the_review') {

                            console.log(Notification.permission);
                            if (Notification.permission == "granted") {
                                popNotice();
                            } else if (Notification.permission != "denied") {
                                Notification.requestPermission(function (permission) {
                                  popNotice();
                                });
                            }
                        }
                    }

                } else {
                    alert('浏览器不支持Notification');    
                }
            }
        });
    }

    //主动调用
    setInterval("func()", 30000);

    
</script>
